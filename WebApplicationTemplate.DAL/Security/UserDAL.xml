<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="" xmlns="http://ibatis.apache.org/mapping">
	<alias>
		<typeAlias alias="User" type="WebApplicationTemplate.Objects.Security.User" />
	</alias>

	<statements>

    <insert id="InsertUser">
			INSERT INTO [User]
			(
			Username
			,Nombre
			,ApellidoPaterno
			,ApellidoMaterno
			,Email
			,Password
			,IsSuperUser
			)
			VALUES
			(
			#Username#
			,#Nombre#
			,#ApellidoPaterno#
			,#ApellidoMaterno#
			,#Email#
			,#Password#
			,#IsSuperUser#
			)

			<selectKey type="post" resultClass="int" property="IdUser">
				SELECT @@IDENTITY
			</selectKey>
    </insert>
    
	<select id="SelectUserByUsername" resultClass="User">
      SELECT * FROM [User] Where Username = #username#
    </select>

    <select id="SelectUserByMacrolynkGUID" resultClass="User">
      SELECT * FROM [User] Where MacrolynkGUID = #macrolynkGUID#
    </select>

    <select id="SelectUserById" resultClass="User">
      SELECT * FROM [User] Where IdUser = #idUser#
    </select>
    
    <select id="SelectUserByUsernameAndSessionToken" resultClass="User">
      SELECT * FROM [User] Where Username = #username# AND SessionToken = #sessionToken#
    </select>
    
    <update id="UpdateSessionToken">
      UPDATE [User] 
      SET SessionToken = #sessionToken#
      WHERE IdUser = #idUser#
    </update>

		<select id="ExisteUsername" parameterClass="User" resultClass="int">
			IF EXISTS(
				SELECT * FROM [User]
				WHERE Username = #Username#
			)
			BEGIN
				SELECT 1
			END
			ELSE BEGIN
				SELECT 0
			END
		</select>
		
	</statements>
</sqlMap>